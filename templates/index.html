<!DOCTYPE <!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EditLab</title>
    <link href="css/style.css" rel="stylesheet">
    <style>
    </style>
    {{ bootstrap.load_css() }}
  </head>
  <body>
    <div class="sidebar">
      <h2>EditLab</h2>

      <!-- Upload Image Tab -->
      <label>
        Upload Image
        <input type="file" id="imageInput" accept=".png, .jpeg, .jpg" />
      </label>

      <!-- Brush Size Input -->
      <label>
        Brush Size
        <input type="range" id="brushSize" min="1" max="20" value="5" />
      </label>

      <!-- Brush Color Input -->
      <label>
        Brush Color
        <input type="color" id="brushColor" value="#ff0000" /> 
      </label>

      <!-- Brush Buttons -->
      <button class="brushTool">Brush</button>
      <button class="eraserTool">Eraser</button>
      <button class="clearCanvas">Clear</button>

      <hr />

      <!-- Filter Dropdown (add later)- Get items from Jayson's filter.py -->
      <button class="resetImage">Reset Image</button>

      <hr />

      <!-- Add image preview (don't use api token) -->
      
      <button class="download">Download</button>
    </div>

    <!-- Drawing Canvas -->
    <div class="canvas-wrapper">
      <canvas id="canvas" width="800" height="600"></canvas>
    </div>
    
    <script>
      // get elements
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const fileInput = document.getElementById("imageInput");
      const brushSizeSlider = document.getElementById("brushSize");
      const brushColorInput = document.getElementById("brushColor");
      const brushButton = document.getElementById("brushTool");
      const eraserSwitchButton = document.getElementById("eraserTool");
      const clearCanvasButton = document.getElementById("clearCanvas");
      const downloadImageButton = document.getElementById("download");

      let drawing = false;
      let currentTool = "brush"; // can be brush || eraser
      let originalImageData = null; 

      function getCanvasPosition(event) {
        const rect = canvas.getBoundingClientRect();
        return {
          x:
            (event.clientX || event.touches?.[0]?.clientX) - rect.left,
          y:
            (event.clientY || event.touches?.[0]?.clientY) - rect.top;
        };
      }

      function startDrawing(event) {
        // update drawing boolean
        drawing = true;

        const pos = getCanvasPosition(event);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
      }

      function draw(event) {
        if (!drawing) return;

        const pos = getCanvasPosition(event);

        ctx.lineWidth = brushSizeSlider.value;
        ctx.lineCap = "round";

        if (currentTool === "eraser") {
          ctx.strokeStyle = "ffffff";
        } else {
          ctx.strokeStyle = brushColorInput.value;
        }

        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
      }
    </script>
    {{ bootstrap.load_js() }}
  </body>
</html>

