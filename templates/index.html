<!DOCTYPE <!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EditLab</title>
    <link href="css/style.css" rel="stylesheet">
    <style>
    /*
    Colors:
    Primary: #17BEBB
    Shadows: #14453D / background
    Highlights: #CD5334
    2nd Highlights: #EDB88B
    */
    canvas {
      margin-top: 20px;
      margin: 10px;
      background-color: rgba(45, 45, 45, 0);
      border: 5px solid #CD5334;
      border-radius: 1rem;
    }
    /* Download, Reset, and Brush Buttons */
    .download, .reset, .brushButton {
      border-radius: 5px;
      margin: 10px;
      border: 0;
      line-height: 2.5;
      padding: 0 20px;
      font-size: 1rem;
      text-align: center;
      color: white;
      text-shadow: 1px 1px 1px black;
      background-color: #17BEBB;
    }
    .download:hover, .reset:hover, .brushButton:hover {
      background-color: #14453D;
    }
    .download:active, .reset:active, .brushButton:active { 
      background-color: #7D84B2;
    }
    /* Eraser & Clear Buttons */
    .eraserButton, .clearButton {
      border-radius: 5px;
      margin: 10px;
      border: 0;
      line-height: 2.5;
      padding: 0 20px;
      font-size: 1rem;
      text-align: center;
      color: white;
      text-shadow: 1px 1px 1px black;
      background-color: #FF0000;
    }
    .eraserButton:hover, .clearButton:hover {
      background-color: #14453D;
    }
    .eraserButton:active, .clearButton:active { 
      background-color: #7D84B2;
    }
    
    /* Vertically Align Tools */
    .verticalTools {
      margin: 10px;
    }
    .brushColor {
      margin-top: 1%;
      vertical-align: baseline;
    }
    /* Title */
    .title {
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      font-size: 50px;
      text-align: center;
    }
    /* Upload Image Card */
    .card {
      margin: 2rem;
    } 
    </style>
    {{ bootstrap.load_css() }}
  </head>
  <body>
    <div class="sidebar">
      <h2 class="title">EditLab</h2>
            
      <!-- Add image preview (don't use api token) -->
      <!-- Upload Image Card -->
      <div class="card" style="width: 18rem;">
        <img src="..." class="card-img-top" alt="Uploaded image preview" />
        <div class="card-body">
          <h5 class="card-title">Upload Image:</h5>
          
          <!-- Choose File Input -->
          <input type="file" id="imageInput" accept=".png, .jpeg, .jpg" />

          <a href="#" class="btn btn-primary" id="uploadToCanvasButton">Load canvas</a>
        </div>
      </div> 

      <hr />

      <button class="brushButton">Brush</button>
      <button class="eraserButton">Eraser</button>
      <button class="clearButton">Clear Brush</button>

      <!-- Brush Tools -->
      <div class="brushTools">
        
        <div class="verticalTools">

          <!-- Filter Dropdown (add later)- Get items from Jayson's filter.py -->
          <label for="filters">Choose a filter:</label>
          <select name="Filters" id="filters">
            <option value="">--Please choose a filter--</option>
          </select>

          <!-- Brush Size Input -->
          <label>
            Brush Size:
            <input type="range" id="brushSize" min="1" max="21" step="5" value="5" />
          </label>

          <!-- Brush Color Input -->
          <label>
            Brush Color:
            <input type="color" id="brushColor" value="#000000" /> 
          </label>
        </div>
      </div>

      <!-- Drawing Canvas -->
      <div class="canvas-wrapper">
        <canvas id="canvasImage" width="800" height="600">
          Your browser doesn't support the canvas tag.         
        </canvas>
      </div>

      <div class="downloadAndReset">
        <!-- Display Download Option -->
        <button class="download">Download</button>

        <!-- Display Reset Image Button -->
        <button class="reset">Reset Image</button>
      </div>
    </div>
    
    <script type="text/javascript">
    // elements for preview of image
    let imageInput = document.querySelector("#imageInput");
    let previewImage = document.querySelector(".card-img-top");
    let uploadCanvasButton = document.querySelector("#uploadToCanvasButton");
    
    // elements for image filter api
    
    // elements for canvas
    let canvas = document.querySelector("#canvasImage");
    var ctx = canvas.getContext("2d");
    
    let currentFileUrl = null;
    let currentFile = null;
    
    /* Displaying Preview of Image */
    imageInput.addEventListener('change', function(event) {
      currentFile = event.target.files[0];
      const localUrl = URL.createObjectURL(currentFile);
      
      currentFileUrl = localUrl;

      previewImage.src = currentFileUrl;
    });
    
    /* Setting background to preview image */
    uploadCanvasButton.addEventListener('click', function(event) {
      if (!currentFile) {
        console.warn("No file selected");
        return;
      }

      // canvas.background = currentFileUrl;
      const reader = new FileReader();

      reader.onload = function(e) {
        const img = new Image();

        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;

          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };
        img.src = e.target.result;
      };
      
      reader.readAsDataURL(currentFile); 
    });

    /* Create 2 separate canvases, one for background/filters & one for drawing */
    
    /* API Dropdown -> First Get Data From Backend To Populate Dropdown */

    </script>
    
    {{ bootstrap.load_js() }}
  </body>
</html>

